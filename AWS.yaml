# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"
run: once

tasks:
  s3-upload-file:
    desc: uploads the given file to the specified S3 bucket
    dir: "{{.USER_WORKING_DIR}}"
    requires: { vars: [FILE_PATH, S3_BUCKET_NAME, S3_OBJECT_KEY] }
    preconditions:
      - sh: "[ -f {{.FILE_PATH}} ]"
        msg: "file {{.FILE_PATH}} does not exist"
    cmd: aws s3 cp {{.FILE_PATH}} s3://{{.S3_BUCKET_NAME}}/{{.S3_OBJECT_KEY}}

  s3-download-file:
    desc: downloads the given object from the specified S3 bucket
    dir: "{{.USER_WORKING_DIR}}"
    requires: { vars: [FILE_PATH, S3_BUCKET_NAME, S3_OBJECT_KEY] }
    cmd: aws s3 cp s3://{{.S3_BUCKET_NAME}}/{{.S3_OBJECT_KEY}} {{.FILE_PATH}}

  s3-list-files:
    desc: list all objects in the specified S3 bucket
    dir: "{{.USER_WORKING_DIR}}"
    requires: { vars: [S3_BUCKET_NAME] }
    cmd: aws s3 ls s3://{{.S3_BUCKET_NAME}} --recursive --human-readable --summarize
